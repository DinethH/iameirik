window.Byutv=window.Byutv||{},Byutv.behaviors=Byutv.behaviors||{},Byutv.behaviors.Jsonp={properties:{activeRequests:{type:Array,notify:!0,readOnly:!0,value:function(){return[]}},auto:{type:Boolean,value:!1},cache:{type:Boolean,value:!1},callbackKey:{type:String,value:"callback"},callbackValue:{type:String,value:function(){return"byutv_jsonp_callback_"+this._newGuid(!0)}},debounceDuration:{type:Number,value:0},lastAborted:{type:Boolean,notify:!0,readOnly:!0,reflectToAttribute:!0,value:!1},lastError:{type:Object,notify:!0,readOnly:!0},lastLoad:{type:Object,notify:!0,readOnly:!0},lastRequest:{type:Object,notify:!0,readOnly:!0},lastResponse:{type:Object,notify:!0,readOnly:!0},loading:{type:Boolean,notify:!0,readOnly:!0,reflectToAttribute:!0,value:!1},params:{type:Object,value:function(){return{}}},sync:{type:Boolean,value:!1},timeoutDuration:{type:Number,value:3e4},url:{type:String,value:""},verbose:{type:Boolean,value:!1}},factoryImpl:function(a){if(a&&"object"===typeof a){var b=this;Object.keys(a).forEach(function(c){b.setAttribute(c,a[c])})}},observers:["_requestOptionsChanged(auto, cache, callbackKey, callbackValue, debounceDuration, params, sync, timeoutDuration, url, verbose)"],get _queryString(){var a=this.params||{};return(void 0===this.callbackKey||this.callbackKey)&&(a[this.callbackKey]=this.callbackValue),this.cache||(a._=this._newGuid(!0)),Object.keys(a).reduce(function(b,c){return b.push(c+"="+encodeURIComponent(a[c]))&&b},[]).join("&")},get _requestUrl(){var a=this._queryString;return a?this.url+"?"+a:this.url},get _requestOptions(){return{cache:this.cache,callbackKey:this.callbackKey,callbackValue:this.callbackValue,sync:this.sync,url:this._requestUrl}},_requestOptionsChanged:function(){this.debounce("generate-request",function(){if(this.auto)try{this.generateRequest()}catch(a){}},this.debounceDuration)},generateRequest:function(){if(this.cache&&(/^byutv_jsonp_callback_[0-9a-f]{32}$/.test(this.callbackValue)||!this.callbackValue))throw new Error("`callback-value` must be declared or `callbackValue` set when `cache` is true.");if(!this.url)throw new Error("`url` must be declared or set in order to perform a request.");var a={};a.loading=!0,this._setLoading(!0),this._setLastAborted(!1),this._setLastRequest(a),this.activeRequests.push(a),a.options=this._requestOptions,a.script=document.createElement("script"),a.script.src=this._requestUrl,a.script.async=!this.sync;var b=this;return a.script.onload=function(c){b._handleLoad(a,c)},a.script.onerror=function(c){clearTimeout(a.timeout),b._handleError(a,c)},window[this.callbackValue]=function(c){clearTimeout(a.timeout),b._handleResponse(a,c)},document.querySelector("head").appendChild(a.script),a.timeout=setTimeout(function(){b._handleError(a,new ErrorEvent("error",{error:new Error("Timeout"),message:"The JSONP request timed out.",filename:"byutv-behaviors-jsonp.js"}))},this.timeoutDuration),this.fire("sent",a),a},abortRequest:function(a){!a&&this.activeRequests.length&&(a=this.activeRequests[this.activeRequests.length-1]),a&&this.activeRequests.indexOf(a)===this.activeRequests.length-1&&this._setLastAborted(!0),this._cleanupRequest(a)},_discardRequest:function(a){this._cleanupRequest(a),this.fire("complete",a)},_cleanupRequest:function(a){var b=this.activeRequests.indexOf(a);if(0<=b){this.activeRequests[b].loading=!1;var c=this.activeRequests.filter(function(d){return d.loading});c.length||this._setLoading(!1),this.activeRequests.splice(b,1),delete window[this.callbackValue],clearTimeout(a.timeout),a.script.parentNode.removeChild(a.script),a=null}},_handleResponse:function(a,b){this._setLastResponse(b),this._setLastError(void 0),this.fire("response",b),this._discardRequest(a)},_handleError:function(a,b){this.verbose&&console.error(b),this._setLastResponse(void 0),this._setLastError(b),this.fire("error",b),this._discardRequest(a)},_handleLoad:function(a,b){this._setLastLoad(b),this.fire("load",b)},_newGuid:function(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var d=0|16*Math.random(),e="x"===c?d:8|3&d;return e.toString(16)});return a?b.replace(/-/g,""):b}};